<!doctype html>
<html>
  <head>
    <title>SION2 HD</title>
    <meta name="theme-color" content="#333333">
    <meta charset="utf-8">
    <link rel="manifest" href="manifest.json">
    <link
        href="https://fonts.googleapis.com/css?family=Geo|Audiowide|Fira+Mono"
        rel="stylesheet">
    <!--
     Copyright 2016 Takashi Toyoshima <toyoshim@gmail.com>. All rights reserved.
     Use of this source code is governed by a BSD-style license that can be
     found in the LICENSE file.
    -->
    <style>
      body {
        margin: 0;
        padding: 0;
        background: #000;
      }
      div {
        border: 0px none;
      }
      canvas {
        display: block;
        border: 0px none;
        position: absolute;
        left: 0px;
        top: 0px;
      }
      iframe {
        width: 0;
        height: 0;
        border: 0;
      }
    </style>
  </head>
  <body>
    <div>
      <canvas id="canvas0" style="z-index: 0;"></canvas>
      <canvas id="canvas1" style="z-index: 1;"></canvas>
      <canvas id="canvas2" style="z-index: 2;"></canvas>
      <canvas id="canvas3" style="z-index: 3;"></canvas>
    </div>
    <iframe src="zmusic.html" id="zmusic"></iframe>
    <script type="text/javascript" charset="UTF-8" src="magic2.js"></script>
    <script type='text/javascript'>
      var zmusic = new Promise(function(resolve, reject) {
        window.addEventListener('message', function(e) {
          if (e.data.type == 'zmusic' && e.data.command == 'init') {
            resolve();
          }
        }, false);
      });
      window.zmusic_bind = function(address, name) {
        document.getElementById('zmusic').contentWindow.postMessage({
          type: 'zmusic',
          command: 'bind',
          key: address,
          value: name
        }, window.location.origin);
      };
      window.zmusic_call = function(d1, d2, d3, d4, a1) {
        document.getElementById('zmusic').contentWindow.postMessage({
          type: 'zmusic',
          command: 'trap',
          d1: d1,
          d2: d2,
          d3: d3,
          d4: d4,
          a1: a1
        }, window.location.origin);
      };
      document.fonts.load('10px Audiowide');
      document.fonts.load('10px \'Fira Mono\'');
      document.fonts.load('10px Geo');
      var canvas = document.getElementsByTagName('canvas');
      /* global Magic2 */
      var magic2 = new Magic2(Array.prototype.map.call(canvas, function(c) {
        // Changes canvas size to fullfill the window.
        c.width = window.innerWidth;
        c.height = window.innerHeight;
        return c.getContext('2d');
      }));
      var Module = {
        preRun: [],
        postRun: [],
        arguments: ['sion2.x'],
        print: function(text) {
          if (arguments.length > 1)
            text = Array.prototype.slice.call(arguments).join('\n');
          console.warn(text);
        },
        printErr: function(text) {
          if (arguments.length > 1)
            text = Array.prototype.slice.call(arguments).join('\n');
          console.error(text);
        },
        preInit: function() {
          Module.addRunDependency("zmusic");
          zmusic.then(function() {
            Module.removeRunDependency("zmusic");
          });
          Module.addRunDependency("fonts");
          document.fonts.ready.then(function() {
            Module.removeRunDependency("fonts");
          });
        }
      };
    </script>
    <script type="text/javascript" charset="UTF-8" src="iocs.js"></script>
    <script type="text/javascript" charset="UTF-8" src="io.js"></script>
    <script type="text/javascript" charset="ShiftJIS" src="sion2.js"></script>
  </body>
</html>
